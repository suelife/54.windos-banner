<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WindOS Dynamic Banner - Test Version</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100%;
            height: 100vh;
            overflow: hidden;
            background: #1a1a1a;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* ä¸»è¦åœ–ç‰‡å®¹å™¨ */
        #banner-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        #banner {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 1.5s ease-in-out;
        }

        #banner.fade {
            opacity: 0;
        }

        /* è¼‰å…¥ä¸­é¡¯ç¤º */
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
            display: none;
        }

        #loading.show {
            display: block;
        }

        /* æ™‚é–“é¡¯ç¤ºå€åŸŸ */
        #time-overlay {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
            background: rgba(0, 0, 0, 0.4);
            padding: 12px 20px;
            border-radius: 12px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        #time-overlay .time {
            font-size: 28px;
            font-weight: 300;
            letter-spacing: 3px;
            margin-bottom: 4px;
        }

        #time-overlay .period {
            font-size: 14px;
            opacity: 0.9;
            text-align: center;
        }

        /* ç‹€æ…‹æŒ‡ç¤ºå™¨ */
        #status-indicator {
            position: absolute;
            bottom: 20px;
            left: 30px;
            color: white;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 16px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            opacity: 0.7;
        }

        /* éŒ¯èª¤é¡¯ç¤º */
        #error-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff6b6b;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            display: none;
        }

        #error-message.show {
            display: block;
        }
    </style>
</head>

<body>
    <div id="banner-container">
        <img id="banner" src="" alt="WindOS Banner">

        <div id="loading">
            <div>è¼‰å…¥ä¸­...</div>
        </div>

        <div id="error-message">
            <div>åœ–ç‰‡è¼‰å…¥å¤±æ•—</div>
            <div style="font-size: 12px; margin-top: 8px; opacity: 0.7;">å·²åˆ‡æ›è‡³å‚™ç”¨åœ–ç‰‡</div>
        </div>
    </div>

    <!-- æ™‚é–“é¡¯ç¤º -->
    <div id="time-overlay">
        <div class="time" id="current-time"></div>
        <div class="period" id="current-period"></div>
    </div>

    <!-- ç‹€æ…‹æŒ‡ç¤ºå™¨ -->
    <div id="status-indicator">
        <div id="status-text">ç³»çµ±æ­£å¸¸</div>
    </div>

    <script>
        // ==========================================
        // ğŸ¯ ä¸»è¦é…ç½®å€åŸŸ - ä½ å¯ä»¥åœ¨é€™è£¡èª¿æ•´è¨­å®š
        // ==========================================

        const CONFIG = {
            // æ™‚é–“å€æ®µè¨­å®š - ä½ å¯ä»¥èª¿æ•´æ™‚é–“å’Œåœ–ç‰‡
            timeSlots: [
                {
                    start: 0,
                    end: 6,
                    image: 'images/night.jpg',
                    name: 'æ·±å¤œæ˜Ÿç©º',
                    emoji: 'ğŸŒ™'
                },
                {
                    start: 6,
                    end: 18,
                    image: 'images/morning.jpg',
                    name: 'ç™½æ—¥æ™‚å…‰',
                    emoji: 'ğŸŒ…'
                },
                {
                    start: 18,
                    end: 24,
                    image: 'images/evening.jpg',
                    name: 'å¤œæ™šæ™‚åˆ†',
                    emoji: 'ğŸŒ‡'
                }
            ],

            // å‚™ç”¨åœ–ç‰‡è¨­å®š
            fallbackImage: 'images/default.jpg',

            // æ›´æ–°é »ç‡è¨­å®šï¼ˆæ¯«ç§’ï¼‰
            updateIntervals: {
                time: 60000,      // æ™‚é–“æ›´æ–°ï¼šæ¯åˆ†é˜
                banner: 300000,   // åœ–ç‰‡æª¢æŸ¥ï¼šæ¯5åˆ†é˜
                force: 3600000    // å¼·åˆ¶æ›´æ–°ï¼šæ¯å°æ™‚
            },

            // å‹•ç•«è¨­å®š
            animation: {
                fadeTime: 300,    // æ·¡å‡ºæ™‚é–“ï¼ˆæ¯«ç§’ï¼‰
                transitionTime: 1500  // CSS éæ¸¡æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰
            }
        };

        // ==========================================
        // ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å€åŸŸ - ä¸€èˆ¬ä¸éœ€è¦ä¿®æ”¹
        // ==========================================

        let currentImageUrl = '';
        let imageLoadAttempts = 0;
        const maxLoadAttempts = 3;

        // å–å¾—ç•¶å‰æ™‚æ®µ
        function getCurrentTimeSlot() {
            const now = new Date();
            const hour = now.getHours();

            for (let slot of CONFIG.timeSlots) {
                if (hour >= slot.start && hour < slot.end) {
                    return slot;
                }
            }
            return CONFIG.timeSlots[0]; // é è¨­è¿”å›ç¬¬ä¸€å€‹æ™‚æ®µ
        }

        // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        function showLoading(show = true) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.add('show');
            } else {
                loading.classList.remove('show');
            }
        }

        // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
        function showError(show = true) {
            const error = document.getElementById('error-message');
            if (show) {
                error.classList.add('show');
                setTimeout(() => error.classList.remove('show'), 3000);
            } else {
                error.classList.remove('show');
            }
        }

        // æ›´æ–°ç‹€æ…‹æŒ‡ç¤ºå™¨
        function updateStatus(message) {
            document.getElementById('status-text').textContent = message;
        }

        // è¼‰å…¥åœ–ç‰‡ï¼ˆå¸¶å‚™ç”¨æ©Ÿåˆ¶ï¼‰
        function loadImageWithFallback(imageUrl, isRetry = false) {
            return new Promise((resolve, reject) => {
                const img = new Image();

                img.onload = () => {
                    resolve(imageUrl);
                };

                img.onerror = () => {
                    if (!isRetry) {
                        console.warn(`åœ–ç‰‡è¼‰å…¥å¤±æ•—: ${imageUrl}ï¼Œå˜—è©¦è¼‰å…¥å‚™ç”¨åœ–ç‰‡`);
                        updateStatus('åœ–ç‰‡è¼‰å…¥å¤±æ•—ï¼Œä½¿ç”¨å‚™ç”¨åœ–ç‰‡');

                        // å˜—è©¦è¼‰å…¥å‚™ç”¨åœ–ç‰‡
                        loadImageWithFallback(CONFIG.fallbackImage, true)
                            .then(resolve)
                            .catch(reject);
                    } else {
                        console.error(`å‚™ç”¨åœ–ç‰‡ä¹Ÿè¼‰å…¥å¤±æ•—: ${imageUrl}`);
                        reject(new Error('æ‰€æœ‰åœ–ç‰‡éƒ½è¼‰å…¥å¤±æ•—'));
                    }
                };

                img.src = imageUrl;
            });
        }

        // æ›´æ–° Banner åœ–ç‰‡
        async function updateBanner() {
            const slot = getCurrentTimeSlot();
            const bannerImg = document.getElementById('banner');

            // å¦‚æœåœ–ç‰‡æ²’è®Šï¼Œå°±ä¸æ›´æ–°
            if (currentImageUrl === slot.image) {
                return;
            }

            console.log(`åˆ‡æ›åˆ°æ™‚æ®µ: ${slot.name} (${slot.start}-${slot.end})`);
            updateStatus(`è¼‰å…¥${slot.name}åœ–ç‰‡ä¸­...`);

            try {
                // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
                showLoading(true);
                bannerImg.classList.add('fade');

                // è¼‰å…¥åœ–ç‰‡ï¼ˆå¸¶å‚™ç”¨æ©Ÿåˆ¶ï¼‰
                const imageUrl = await loadImageWithFallback(slot.image);

                setTimeout(() => {
                    bannerImg.src = imageUrl;
                    currentImageUrl = slot.image;

                    // åœ–ç‰‡è¼‰å…¥å¾Œæ·¡å…¥
                    bannerImg.onload = () => {
                        bannerImg.classList.remove('fade');
                        showLoading(false);
                        updateStatus(`${slot.emoji} ${slot.name}`);
                    };
                }, CONFIG.animation.fadeTime);

            } catch (error) {
                console.error('åœ–ç‰‡æ›´æ–°å¤±æ•—:', error);
                showError(true);
                showLoading(false);
                updateStatus('åœ–ç‰‡è¼‰å…¥å¤±æ•—');
            }
        }

        // æ›´æ–°æ™‚é–“é¡¯ç¤º
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-TW', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            });

            const slot = getCurrentTimeSlot();

            document.getElementById('current-time').textContent = timeStr;
            document.getElementById('current-period').textContent = `${slot.emoji} ${slot.name}`;
        }

        // ==========================================
        // ğŸš€ åˆå§‹åŒ–å’Œå®šæ™‚å™¨
        // ==========================================

        // åˆå§‹åŒ–
        async function init() {
            console.log('WindOS Banner åˆå§‹åŒ–ä¸­...');
            updateStatus('ç³»çµ±åˆå§‹åŒ–ä¸­...');

            try {
                await updateBanner();
                updateTime();
                updateStatus('ç³»çµ±å°±ç·’');
                console.log('WindOS Banner åˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±æ•—:', error);
                updateStatus('åˆå§‹åŒ–å¤±æ•—');
            }
        }

        // è¨­å®šå®šæ™‚å™¨
        function setupTimers() {
            // æ¯åˆ†é˜æ›´æ–°æ™‚é–“
            setInterval(updateTime, CONFIG.updateIntervals.time);

            // æ¯ 5 åˆ†é˜æª¢æŸ¥æ˜¯å¦éœ€è¦åˆ‡æ›åœ–ç‰‡
            setInterval(updateBanner, CONFIG.updateIntervals.banner);

            // æ¯å°æ™‚å¼·åˆ¶æª¢æŸ¥ä¸€æ¬¡
            setInterval(() => {
                console.log('åŸ·è¡Œå¼·åˆ¶æ›´æ–°æª¢æŸ¥');
                updateBanner();
            }, CONFIG.updateIntervals.force);
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            init();
            setupTimers();
        });

        // é é¢é‡æ–°ç²å¾—ç„¦é»æ™‚æ›´æ–°ï¼ˆå¾å…¶ä»–åˆ†é å›ä¾†æ™‚ï¼‰
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                console.log('é é¢é‡æ–°ç²å¾—ç„¦é»ï¼Œæ›´æ–° Banner');
                updateBanner();
                updateTime();
            }
        });

        // ==========================================
        // ğŸ¯ é™¤éŒ¯ç”¨åŠŸèƒ½ - ä½ å¯ä»¥åœ¨ç€è¦½å™¨ Console ä½¿ç”¨
        // ==========================================

        // å…¨åŸŸå‡½æ•¸ï¼Œæ–¹ä¾¿é™¤éŒ¯
        window.WindOSBanner = {
            // æ‰‹å‹•åˆ‡æ›åˆ°æŒ‡å®šæ™‚æ®µ
            switchToSlot: (slotIndex) => {
                if (slotIndex >= 0 && slotIndex < CONFIG.timeSlots.length) {
                    const slot = CONFIG.timeSlots[slotIndex];
                    currentImageUrl = ''; // å¼·åˆ¶æ›´æ–°
                    CONFIG.timeSlots.forEach((s, i) => {
                        if (i === slotIndex) {
                            s.start = new Date().getHours();
                            s.end = new Date().getHours() + 1;
                        }
                    });
                    updateBanner();
                }
            },

            // é¡¯ç¤ºç•¶å‰é…ç½®
            showConfig: () => {
                console.table(CONFIG.timeSlots);
            },

            // æ¸¬è©¦å‚™ç”¨åœ–ç‰‡
            testFallback: () => {
                const fakeSlot = { image: 'fake-image.jpg', name: 'æ¸¬è©¦', emoji: 'ğŸ§ª' };
                CONFIG.timeSlots[0] = fakeSlot;
                currentImageUrl = '';
                updateBanner();
            }
        };
    </script>
</body>

</html>